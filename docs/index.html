<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brawl Stars Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0d0d1a;
  --surface: #13132b;
  --surface2: #1a1a38;
  --accent: #f9c400;
  --accent2: #ff6b35;
  --accent3: #00e5ff;
  --purple: #9b5de5;
  --green: #00f593;
  --red: #ff3860;
  --text: #e8e8ff;
  --muted: #7070a0;
  --border: rgba(255,255,255,0.07);
  --sidebar-w: 220px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg); color: var(--text);
  font-family: 'Nunito', sans-serif;
  min-height: 100vh; display: flex; overflow-x: hidden;
}
body::before {
  content: ''; position: fixed; inset: 0;
  background:
    radial-gradient(ellipse 70% 60% at 5% 15%, rgba(155,93,229,0.1) 0%, transparent 60%),
    radial-gradient(ellipse 50% 50% at 95% 85%, rgba(249,196,0,0.07) 0%, transparent 60%);
  pointer-events: none; z-index: 0;
}

/* SIDEBAR */
.sidebar {
  width: var(--sidebar-w); min-height: 100vh;
  background: var(--surface); border-right: 1.5px solid var(--border);
  display: flex; flex-direction: column;
  position: fixed; left: 0; top: 0; bottom: 0; z-index: 100;
}
.sidebar-logo {
  display: flex; align-items: center; gap: 12px;
  padding: 26px 20px 22px; border-bottom: 1px solid var(--border);
}
.logo-icon {
  width: 40px; height: 40px; background: var(--accent);
  border-radius: 12px; display: flex; align-items: center; justify-content: center;
  font-size: 22px; box-shadow: 0 0 16px rgba(249,196,0,0.35); flex-shrink: 0;
}
.logo-text {
  font-family: 'Boogaloo', cursive; font-size: 1.1rem;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.logo-sub { font-size: 0.63rem; color: var(--muted); font-weight: 600; }
.sidebar-player {
  padding: 14px 20px; border-bottom: 1px solid var(--border); display: none;
}
.sp-name { font-family: 'Boogaloo', cursive; font-size: 1rem; color: var(--accent); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.sp-tag  { font-size: 0.7rem; color: var(--muted); margin-top: 1px; }
.sp-trophies { display: flex; align-items: center; gap: 5px; margin-top: 7px; font-size: 0.8rem; font-weight: 700; color: var(--accent); }
.sidebar-nav { flex: 1; padding: 14px 12px; display: flex; flex-direction: column; gap: 3px; }
.nav-section-label { font-size: 0.61rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); font-weight: 700; padding: 8px 8px 3px; margin-top: 6px; }
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px; border-radius: 12px; cursor: pointer;
  transition: all 0.2s; font-size: 0.87rem; font-weight: 700;
  color: var(--muted); border: 1.5px solid transparent; user-select: none;
}
.nav-item:hover { background: var(--surface2); color: var(--text); }
.nav-item.active { background: rgba(249,196,0,0.1); border-color: rgba(249,196,0,0.2); color: var(--accent); }
.nav-icon { font-size: 1.1rem; flex-shrink: 0; width: 22px; text-align: center; }
.sidebar-footer { padding: 14px 18px; border-top: 1px solid var(--border); }
.refresh-btn {
  width: 100%; background: var(--surface2); border: 1.5px solid var(--border);
  border-radius: 10px; padding: 9px; color: var(--muted);
  font-family: 'Nunito', sans-serif; font-size: 0.8rem; font-weight: 700;
  cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;
}
.refresh-btn:hover { border-color: var(--accent3); color: var(--accent3); }

/* MAIN */
.main { margin-left: var(--sidebar-w); flex: 1; position: relative; z-index: 1; min-height: 100vh; }
.page { display: none; padding: 36px 36px 60px; max-width: 1200px; animation: fadeIn 0.3s ease; }
.page.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
.page-header { margin-bottom: 30px; }
.page-title {
  font-family: 'Boogaloo', cursive; font-size: 2rem;
  background: linear-gradient(135deg, var(--text), var(--muted));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.page-subtitle { color: var(--muted); font-size: 0.84rem; margin-top: 4px; }

/* CONNECTION PAGE */
.config-card {
  background: var(--surface); border: 1.5px solid var(--border);
  border-radius: 18px; padding: 26px; margin-bottom: 18px;
  position: relative; overflow: hidden;
}
.config-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--accent3), var(--purple));
}
.config-card-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); font-weight: 700; margin-bottom: 18px; }
.fields-row { display: flex; gap: 14px; flex-wrap: wrap; }
.input-group { flex: 1; min-width: 200px; }
.input-group label { display: block; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); margin-bottom: 7px; font-weight: 700; }
.input-group input {
  width: 100%; background: var(--surface2); border: 1.5px solid var(--border);
  border-radius: 12px; padding: 12px 15px; color: var(--text);
  font-family: 'Nunito', sans-serif; font-size: 0.94rem; transition: all 0.25s; outline: none;
}
.input-group input::placeholder { color: var(--muted); }
.input-group input:focus { border-color: var(--accent3); box-shadow: 0 0 0 3px rgba(0,229,255,0.1); }
.proxy-row { display: flex; align-items: flex-end; gap: 12px; padding-top: 18px; border-top: 1px solid var(--border); margin-top: 18px; flex-wrap: wrap; }
.proxy-status { display: flex; align-items: center; gap: 8px; font-size: 0.8rem; color: var(--muted); padding-bottom: 12px; flex-shrink: 0; }
.dot { width: 8px; height: 8px; border-radius: 50%; background: var(--muted); transition: background 0.3s; }
.dot.green { background: var(--green); box-shadow: 0 0 6px var(--green); }
.dot.red   { background: var(--red);   box-shadow: 0 0 6px var(--red); }
.btn {
  padding: 12px 22px; border-radius: 12px; border: none; cursor: pointer;
  font-family: 'Boogaloo', cursive; font-size: 1rem; letter-spacing: 0.5px;
  transition: all 0.2s; display: flex; align-items: center; gap: 8px;
  align-self: flex-end; white-space: nowrap;
}
.btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #1a0a00; box-shadow: 0 4px 18px rgba(249,196,0,0.3); }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 26px rgba(249,196,0,0.4); }
.btn-ghost { background: transparent; border: 1.5px solid var(--border); color: var(--muted); }
.btn-ghost:hover { border-color: var(--accent3); color: var(--accent3); }

/* PLAYER BANNER */
.player-banner {
  background: var(--surface); border: 1.5px solid var(--border);
  border-radius: 20px; padding: 22px 26px; margin-bottom: 26px;
  display: flex; align-items: center; gap: 18px;
  position: relative; overflow: hidden; flex-wrap: wrap;
}
.player-banner::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--accent), var(--accent2), var(--purple)); }
.player-avatar { width: 60px; height: 60px; background: linear-gradient(135deg, var(--purple), var(--accent3)); border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 30px; flex-shrink: 0; }
.player-info h2 { font-family: 'Boogaloo', cursive; font-size: 1.65rem; color: var(--accent); }
.player-tag { color: var(--muted); font-size: 0.8rem; margin: 2px 0 8px; }
.stat-pills { display: flex; gap: 8px; flex-wrap: wrap; }
.pill { background: var(--surface2); border: 1px solid var(--border); border-radius: 50px; padding: 5px 12px; font-size: 0.79rem; font-weight: 700; display: flex; align-items: center; gap: 5px; }
.pill .val { color: var(--accent3); }
.pill .val.gold  { color: var(--accent); }
.pill .val.green { color: var(--green); }

/* STAT CARDS */
.section-title { font-family: 'Boogaloo', cursive; font-size: 1.25rem; margin-bottom: 14px; color: var(--text); }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 14px; margin-bottom: 28px; }
.stat-card {
  background: var(--surface); border: 1.5px solid var(--border);
  border-radius: 18px; padding: 20px 22px;
  position: relative; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s;
}
.stat-card:hover { transform: translateY(-3px); box-shadow: 0 12px 32px rgba(0,0,0,0.35); }
.stat-card-accent { position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.stat-card-icon { font-size: 1.7rem; margin-bottom: 10px; display: block; }
.stat-card-label { font-size: 0.68rem; text-transform: uppercase; letter-spacing: 1.5px; color: var(--muted); font-weight: 700; margin-bottom: 8px; }
.stat-card-main { display: flex; align-items: baseline; gap: 7px; margin-bottom: 10px; }
.stat-card-value { font-family: 'Boogaloo', cursive; font-size: 2.3rem; line-height: 1; }
.stat-card-total { font-size: 1rem; color: var(--muted); font-weight: 700; }
.stat-progress-bg { height: 6px; background: rgba(255,255,255,0.06); border-radius: 50px; overflow: hidden; margin-bottom: 7px; }
.stat-progress-fill { height: 100%; border-radius: 50px; transition: width 1.2s cubic-bezier(0.22,1,0.36,1); }
.stat-progress-pct { font-size: 0.7rem; color: var(--muted); font-weight: 700; }

/* COST CARDS */
.cost-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
.cost-card { background: var(--surface); border: 1.5px solid var(--border); border-radius: 18px; padding: 22px 24px; position: relative; overflow: hidden; }
.cost-card-accent { position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.cost-card-title { font-family: 'Boogaloo', cursive; font-size: 1.15rem; margin-bottom: 3px; }
.cost-card-subtitle { font-size: 0.73rem; color: var(--muted); margin-bottom: 16px; }
.cost-row { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--border); }
.cost-row:last-child { border-bottom: none; }
.cost-icon { font-size: 1.2rem; flex-shrink: 0; width: 26px; text-align: center; }
.cost-label { flex: 1; font-size: 0.83rem; font-weight: 600; }
.cost-value { font-family: 'Boogaloo', cursive; font-size: 1.25rem; }
.cost-gold  { color: var(--accent); }
.cost-power { color: var(--purple); }
.cost-zero  { color: var(--green); }

/* BRAWLERS PAGE */
.filters { display: flex; gap: 10px; margin-bottom: 18px; flex-wrap: wrap; align-items: center; }
.filter-label { color: var(--muted); font-size: 0.74rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
.filter-btn { background: var(--surface); border: 1.5px solid var(--border); border-radius: 50px; padding: 6px 13px; color: var(--muted); font-family: 'Nunito', sans-serif; font-size: 0.79rem; font-weight: 700; cursor: pointer; transition: all 0.2s; }
.filter-btn:hover, .filter-btn.active { background: var(--accent); border-color: var(--accent); color: #1a0a00; }
.sort-select { background: var(--surface); border: 1.5px solid var(--border); border-radius: 50px; padding: 6px 14px; color: var(--text); font-family: 'Nunito', sans-serif; font-size: 0.79rem; font-weight: 700; cursor: pointer; outline: none; margin-left: auto; }
.brawler-count { color: var(--muted); font-size: 0.81rem; margin-bottom: 14px; }
.brawler-count span { color: var(--accent3); font-weight: 800; }
.brawlers-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(285px, 1fr)); gap: 15px; }
.brawler-card { background: var(--surface); border: 1.5px solid var(--border); border-radius: 18px; overflow: hidden; transition: transform 0.25s, box-shadow 0.25s, border-color 0.25s; animation: fadeUp 0.4s ease both; }
@keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
.brawler-card:hover { transform: translateY(-4px); box-shadow: 0 14px 36px rgba(0,0,0,0.4); border-color: rgba(255,255,255,0.14); }
.card-header { padding: 15px 17px 12px; display: flex; align-items: center; gap: 12px; position: relative; border-bottom: 1px solid var(--border); }
.rarity-strip { position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.brawler-icon { width: 58px; height: 58px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 26px; flex-shrink: 0; overflow: hidden; }
.brawler-icon img { width: 100%; height: 100%; object-fit: cover; object-position: top center; border-radius: 12px; display: block; }
.brawler-icon.emoji-icon { font-size: 23px; }
.brawler-name { font-family: 'Boogaloo', cursive; font-size: 1.12rem; letter-spacing: 0.5px; }
.brawler-role { font-size: 0.67rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); font-weight: 700; }
.level-badge { margin-left: auto; background: var(--surface2); border: 1.5px solid var(--border); border-radius: 10px; padding: 5px 9px; text-align: center; flex-shrink: 0; }
.lvl-num { font-family: 'Boogaloo', cursive; font-size: 1.3rem; line-height: 1; }
.lvl-label { font-size: 0.57rem; text-transform: uppercase; letter-spacing: 1px; color: var(--muted); }
.lvl-1,.lvl-2,.lvl-3 { color: #888; }
.lvl-4,.lvl-5,.lvl-6 { color: var(--green); }
.lvl-7,.lvl-8,.lvl-9 { color: var(--accent3); }
.lvl-10,.lvl-11 { color: var(--accent); text-shadow: 0 0 8px rgba(249,196,0,0.5); }
.card-body { padding: 12px 15px 14px; }
.trophy-row { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
.trophy-bar-bg { flex: 1; height: 6px; background: rgba(255,255,255,0.05); border-radius: 50px; overflow: hidden; }
.trophy-bar-fill { height: 100%; border-radius: 50px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width 1s cubic-bezier(0.22,1,0.36,1); }
.trophy-val { font-size: 0.82rem; font-weight: 800; color: var(--accent); min-width: 46px; text-align: right; }
.upgrades-section { margin-top: 8px; }
.upg-title { font-size: 0.64rem; text-transform: uppercase; letter-spacing: 1.2px; color: var(--muted); font-weight: 700; margin-bottom: 5px; }
.upg-list { display: flex; flex-direction: column; gap: 4px; }
.upg-item { background: var(--surface2); border: 1px solid var(--border); border-radius: 9px; padding: 6px 10px; display: flex; align-items: center; gap: 7px; font-size: 0.78rem; font-weight: 600; }
.upg-icon { font-size: 0.88rem; flex-shrink: 0; }
.upg-name { flex: 1; }
.upg-type { font-size: 0.59rem; text-transform: uppercase; letter-spacing: 1px; padding: 2px 6px; border-radius: 50px; font-weight: 800; flex-shrink: 0; }
.type-gadget { background: rgba(155,93,229,0.2); color: var(--purple); }
.type-star   { background: rgba(249,196,0,0.15);  color: var(--accent); }
.type-gear   { background: rgba(0,229,255,0.12);   color: var(--accent3); }
.no-upgrades { color: var(--muted); font-size: 0.74rem; font-style: italic; }

/* Rarity strips */
.rarity-Ultra-Legendary { background: linear-gradient(90deg,#ff2020,#ff6600); }
.rarity-Legendary       { background: linear-gradient(90deg,#ffcc00,#ff8800); }
.rarity-Mythic          { background: linear-gradient(90deg,#ff4466,#cc0033); }
.rarity-Epic            { background: linear-gradient(90deg,#cc44ff,#8800cc); }
.rarity-Super-Rare      { background: linear-gradient(90deg,#0088ff,#0055cc); }
.rarity-Rare            { background: linear-gradient(90deg,#00d084,#00a060); }
.rarity-Common          { background: linear-gradient(90deg,#aaaaaa,#777777); }
.rarity-default         { background: linear-gradient(90deg,#555,#333); }
.icon-bg-Ultra-Legendary { background: rgba(255,50,50,0.2); }
.icon-bg-Legendary       { background: rgba(255,204,0,0.15); }
.icon-bg-Mythic          { background: rgba(255,68,102,0.15); }
.icon-bg-Epic            { background: rgba(204,68,255,0.15); }
.icon-bg-Super-Rare      { background: rgba(0,136,255,0.15); }
.icon-bg-Rare            { background: rgba(0,208,132,0.15); }
.icon-bg-Common          { background: rgba(180,180,180,0.12); }
.icon-bg-default         { background: rgba(100,100,100,0.12); }
.icon-bg-Unknown         { background: rgba(100,100,100,0.12); }

/* STATES */
.state-box { text-align: center; padding: 70px 20px; color: var(--muted); }
.state-box .icon { font-size: 3rem; margin-bottom: 13px; }
.state-box h3 { font-family: 'Boogaloo', cursive; font-size: 1.4rem; color: var(--text); margin-bottom: 7px; }
.state-box p { font-size: 0.86rem; max-width: 340px; margin: 0 auto; line-height: 1.6; }
.spinner { width: 42px; height: 42px; border: 3px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.7s linear infinite; margin: 0 auto 18px; }
@keyframes spin { to { transform: rotate(360deg); } }

/* RESPONSIVE */
@media (max-width: 768px) {
  :root { --sidebar-w: 64px; }
  .logo-text, .logo-sub, .nav-label, .sidebar-player, .nav-section-label { display: none; }
  .nav-item { justify-content: center; padding: 12px; }
  .sidebar-logo { justify-content: center; padding: 18px 10px; }
  .page { padding: 22px 14px 48px; }
  .stats-grid { grid-template-columns: 1fr 1fr; }
  .brawlers-grid { grid-template-columns: 1fr; }
  .refresh-btn span { display: none; }
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">‚ö°</div>
    <div>
      <div class="logo-text">Brawl Stats</div>
      <div class="logo-sub">Dashboard</div>
    </div>
  </div>

  <div class="sidebar-player" id="sidebarPlayer">
    <div class="sp-name" id="spName">‚Äî</div>
    <div class="sp-tag"  id="spTag">‚Äî</div>
    <div class="sp-trophies">üèÜ <span id="spTrophies">‚Äî</span></div>
  </div>

  <div class="sidebar-nav">
    <span class="nav-section-label">General</span>
    <div class="nav-item" id="nav-dashboard" onclick="goTo('dashboard')">
      <span class="nav-icon">üìä</span>
      <span class="nav-label">Dashboard</span>
    </div>
    <div class="nav-item" id="nav-brawlers" onclick="goTo('brawlers')">
      <span class="nav-icon">üéÆ</span>
      <span class="nav-label">Mis Brawlers</span>
    </div>
    <span class="nav-section-label">Ajustes</span>
    <div class="nav-item" id="nav-connection" onclick="goTo('connection')">
      <span class="nav-icon">üîå</span>
      <span class="nav-label">Conexi√≥n</span>
    </div>
  </div>

  <div class="sidebar-footer">
    <button class="refresh-btn" onclick="fetchPlayer()">
      üîÑ <span>Actualizar</span>
    </button>
  </div>
</nav>

<!-- MAIN -->
<main class="main">

  <!-- CONNECTION PAGE -->
  <div class="page" id="page-connection">
    <div class="page-header">
      <div class="page-title">Conexi√≥n</div>
      <div class="page-subtitle">Introduce tu Player Tag para cargar tus datos</div>
    </div>
    <div class="config-card">
      <div class="config-card-title">üéÆ Tu cuenta de Brawl Stars</div>
      <div class="fields-row">
        <div class="input-group" style="max-width:240px">
          <label>Player Tag</label>
          <input type="text" id="playerTag" placeholder="#2PP00" />
        </div>
        <button class="btn btn-primary" onclick="fetchPlayer()">üîç Buscar</button>
      </div>
      <div class="proxy-row">
        <div class="proxy-status" style="padding-bottom:0; gap:10px">
          <div class="dot" id="proxyDot"></div>
          <span id="proxyStatusText">Backend: brawlstars-dashboard.onrender.com</span>
          <button class="btn btn-ghost" style="padding:7px 14px;font-size:0.8rem" onclick="testProxy()">Probar conexi√≥n</button>
        </div>
      </div>
    </div>
    <div id="stateIdle" class="state-box">
      <div class="icon">üîå</div>
      <h3>Sin datos todav√≠a</h3>
      <p>Introduce tu Player Tag y pulsa Buscar para cargar tus datos.</p>
    </div>
    <div id="stateLoading" class="state-box" style="display:none">
      <div class="spinner"></div>
      <h3>Cargando...</h3>
      <p>Consultando la API de Brawl Stars a trav√©s del proxy...</p>
    </div>
    <div id="stateError" class="state-box" style="display:none">
      <div class="icon">‚ùå</div>
      <h3 id="errorTitle">Error</h3>
      <p id="errorMsg"></p>
    </div>
  </div>

  <!-- DASHBOARD PAGE -->
  <div class="page" id="page-dashboard">
    <div id="dashboardEmpty" class="state-box">
      <div class="icon">üìä</div>
      <h3>No hay datos cargados</h3>
      <p>Ve a <strong>Conexi√≥n</strong> e introduce tus credenciales para ver el dashboard.</p>
    </div>
    <div id="dashboardContent" style="display:none">
      <div class="page-header">
        <div class="page-title" id="dashTitle">Dashboard</div>
        <div class="page-subtitle" id="dashSubtitle">Resumen de tu cuenta</div>
      </div>
      <div class="player-banner">
        <div class="player-avatar">üéÆ</div>
        <div class="player-info">
          <h2 id="playerName">‚Äî</h2>
          <div class="player-tag" id="playerTagDisplay">‚Äî</div>
          <div class="stat-pills" id="statPills"></div>
        </div>
      </div>
      <div class="section-title">üìà Progreso de colecci√≥n</div>
      <div class="stats-grid" id="statsGrid"></div>
      <div class="section-title" style="margin-top:30px">üí∞ ¬øCu√°nto falta para el m√°ximo?</div>
      <div class="cost-grid" id="costGrid"></div>
    </div>
  </div>

  <!-- BRAWLERS PAGE -->
  <div class="page" id="page-brawlers">
    <div class="page-header">
      <div class="page-title">Mis Brawlers</div>
      <div class="page-subtitle">Lista completa con estad√≠sticas, gadgets y star powers</div>
    </div>
    <div id="brawlersEmpty" class="state-box">
      <div class="icon">üéÆ</div>
      <h3>No hay datos cargados</h3>
      <p>Ve a <strong>Conexi√≥n</strong> e introduce tus credenciales para ver tus brawlers.</p>
    </div>
    <div id="brawlersContent" style="display:none">
      <div class="filters">
        <span class="filter-label">Rareza</span>
        <button class="filter-btn active" onclick="setFilter('all',this)">Todos</button>
        <button class="filter-btn" onclick="setFilter('Ultra Legendary',this)">Ultra Legendary</button>
        <button class="filter-btn" onclick="setFilter('Legendary',this)">Legendary</button>
        <button class="filter-btn" onclick="setFilter('Mythic',this)">Mythic</button>
        <button class="filter-btn" onclick="setFilter('Epic',this)">Epic</button>
        <button class="filter-btn" onclick="setFilter('Super Rare',this)">Super Rare</button>
        <button class="filter-btn" onclick="setFilter('Rare',this)">Rare</button>
        <button class="filter-btn" onclick="setFilter('Common',this)">Common</button>
        <select class="sort-select" id="sortSelect" onchange="renderBrawlers()">
          <option value="trophies">Trofeos ‚Üì</option>
          <option value="level">Nivel ‚Üì</option>
          <option value="name">Nombre A-Z</option>
        </select>
      </div>
      <div class="brawler-count" id="brawlerCount"></div>
      <div class="brawlers-grid" id="brawlersGrid"></div>
    </div>
  </div>

</main>

<script>
// ‚îÄ‚îÄ‚îÄ Constants ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// Base URL for portraits (GitHub Pages serves from repo root)
const ASSET_BASE    = window.location.pathname.replace(/\/frontend\/.*$/, '')
const PORTRAIT_BASE = ASSET_BASE + '/assets/brawler_portraits'

// Maps API brawler name ‚Üí portrait filename (without _portrait.png)
const PORTRAITS = {
  '8-Bit':          '8bit',
  'Alli':           'alli',
  'Amber':          'amber',
  'Angelo':         'angelo',
  'Ash':            'ash',
  'Barley':         'barley',
  'Bea':            'bea',
  'Belle':          'belle',
  'Berry':          'berry',
  'Bibi':           'bibi',
  'Bo':             'bo',
  'Bonnie':         'bonnie',
  'Brock':          'brock',
  'Bull':           'bull',
  'Buster':         'buster',
  'Buzz':           'buzz',
  'Byron':          'byron',
  'Carl':           'carl',
  'Charlie':        'charlie',
  'Chester':        'chester',
  'Chuck':          'chuck',
  'Clancy':         'clancy',
  'Colette':        'colette',
  'Colt':           'colt',
  'Cordelius':      'cordelius',
  'Crow':           'crow',
  'Darryl':         'darryl',
  'Doug':           'doug',
  'Draco':          'draco',
  'Dynamike':       'dynamike',
  'Edgar':          'edgar',
  'El Primo':       'elprimo',
  'Emz':            'emz',
  'Eve':            'eve',
  'Fang':           'fang',
  'Finx':           'finx',
  'Frank':          'frank',
  'Gale':           'gale',
  'Gene':           'gene',
  'Gigi':           'gigi',
  'Glowbert':       'glowbert',
  'Gray':           'gray',
  'Griff':          'griff',
  'Grom':           'grom',
  'Gus':            'gus',
  'Hank':           'hank',
  'Jacky':          'jacky',
  'Jae-Yong':       'jae-yong',
  'Janet':          'janet',
  'Jessie':         'jessie',
  'Juju':           'juju',
  'Kaze':           'kaze',
  'Kenji':          'kenji',
  'Kit':            'kit',
  'Larry & Lawrie': 'larry&lawrie',
  'Leon':           'leon',
  'Lily':           'lily',
  'Lola':           'lola',
  'Lou':            'lou',
  'Lumi':           'lumi',
  'Maisie':         'maisie',
  'Mandy':          'mandy',
  'Max':            'max',
  'Meeple':         'meeple',
  'Meg':            'meg',
  'Melodie':        'melodie',
  'Mico':           'mico',
  'Mina':           'mina',
  'Moe':            'moe',
  'Mortis':         'mortis',
  'Mr. P':          'mrp',
  'Nani':           'nani',
  'Nita':           'nita',
  'Ollie':          'ollie',
  'Otis':           'otis',
  'Pam':            'pam',
  'Pearl':          'pearl',
  'Penny':          'penny',
  'Pierce':         'pierce',
  'Piper':          'piper',
  'Poco':           'poco',
  'Rico':           'rico',
  'Rosa':           'rosa',
  'R-T':            'rt',
  'Ruffs':          'ruffs',
  'Sam':            'sam',
  'Sandy':          'sandy',
  'Shade':          'shade',
  'Shelly':         'Shelly',
  'Spike':          'spike',
  'Sprout':         'sprout',
  'Squeak':         'squeak',
  'Stu':            'stu',
  'Surge':          'surge',
  'Tara':           'tara',
  'Tick':           'tick',
  'Trunk':          'trunk',
  'Willow':         'willow',
  'Ziggy':          'ziggy',
}

function getPortrait(name) {
  const key = PORTRAITS[name]
  if (!key) return null
  return `${PORTRAIT_BASE}/${key}_portrait.png`
}

// Gold cost to go from level X to X+1
const GOLD_PER_LEVEL = [0, 20, 35, 75, 140, 290, 480, 800, 1250, 1875, 2800]
// Power points needed to go from level X to X+1 (index = from level)
const PP_PER_LEVEL   = [0, 20, 30, 50,  80, 130, 210, 340,  550,  890, 1440] // lv10‚Üí11 costs 1440 PP
const GADGET_COST    = 1000
const STARPOWER_COST = 2000

// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let allBrawlers = [], rarityMap = {}, gadgetCountMap = {}, spCountMap = {}, rarityJSON = {}
let currentFilter = 'all', playerData = null

// ‚îÄ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goTo(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'))
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'))
  document.getElementById('page-' + page).classList.add('active')
  document.getElementById('nav-' + page).classList.add('active')
}

// ‚îÄ‚îÄ‚îÄ Hardcoded backend (no config needed) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const PROXY = 'https://brawlstars-dashboard.onrender.com'

// ‚îÄ‚îÄ‚îÄ Load rarity JSON from repo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let rarityJSONReady = false
async function loadRarityJSON() {
  try {
    const base = window.location.pathname.replace(/\/frontend\/.*$/, '')
    const res = await fetch(base + '/assets/brawler_rarities.json', { cache: 'no-cache' })
    if (!res.ok) throw new Error('Could not load rarities')
    const data = await res.json()
    // Flatten { "Legendary": ["Spike", ...] } ‚Üí { "Spike": "Legendary", ... }
    for (const [rarity, names] of Object.entries(data)) {
      for (const name of names) rarityJSON[name] = rarity
    }
    rarityJSONReady = true
    console.log(`‚úÖ Loaded ${Object.keys(rarityJSON).length} brawler rarities`)
  } catch(e) {
    console.warn('Could not load brawler_rarities.json:', e.message)
  }
}

window.addEventListener('load', async () => {
  await loadRarityJSON()
  const saved = localStorage.getItem('bs_config')
  if (saved) {
    try {
      const cfg = JSON.parse(saved)
      if (cfg.tag) document.getElementById('playerTag').value = cfg.tag
    } catch {}
  }
  goTo('dashboard')
})

function saveConfig() {
  localStorage.setItem('bs_config', JSON.stringify({
    tag: document.getElementById('playerTag').value,
  }))
}

// ‚îÄ‚îÄ‚îÄ Proxy test ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function testProxy() {
  const dot = document.getElementById('proxyDot'), txt = document.getElementById('proxyStatusText')
  dot.className = 'dot'; txt.textContent = 'Probando...'
  try {
    const res = await fetch(`${PROXY}/`, { signal: AbortSignal.timeout(8000) })
    if (res.ok) { dot.className = 'dot green'; txt.textContent = 'Conectado ‚úì ‚Äî brawlstars-dashboard.onrender.com' }
    else throw new Error(`HTTP ${res.status}`)
  } catch(e) { dot.className = 'dot red'; txt.textContent = 'Error: ' + e.message }
}

// ‚îÄ‚îÄ‚îÄ Fetch ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchPlayer() {
  const rawTag = document.getElementById('playerTag').value.trim()
  if (!rawTag) { goTo('connection'); alert('Introduce el Player Tag.'); return }
  saveConfig()
  const tag = rawTag.startsWith('#') ? rawTag.slice(1) : rawTag
  document.getElementById('stateIdle').style.display    = 'none'
  document.getElementById('stateLoading').style.display = 'block'
  document.getElementById('stateError').style.display   = 'none'
  goTo('connection')
  try {
    const [pRes, bRes] = await Promise.all([
      fetch(`${PROXY}/player/${tag}`),
      fetch(`${PROXY}/brawlers`),
    ])
    if (!pRes.ok) { const e = await pRes.json().catch(()=>({})); throw new Error(e.error || `HTTP ${pRes.status}`) }
    playerData = await pRes.json()
    const meta = bRes.ok ? await bRes.json() : { items: [] }
    rarityMap = {}; gadgetCountMap = {}; spCountMap = {}
    for (const b of (meta.items || [])) {
      rarityMap[b.name]      = b.rarity?.name || 'default'
      gadgetCountMap[b.name] = (b.gadgets    || []).length
      spCountMap[b.name]     = (b.starPowers || []).length
    }
    window._totalInGame = (meta.items || []).length || 80
    allBrawlers = (playerData.brawlers || []).map(b => ({
      ...b,
      rarity:       rarityMap[b.name] || rarityJSON[b.name] || 'Unknown',
      totalGadgets: gadgetCountMap[b.name] ?? 2,
      totalSP:      spCountMap[b.name]     ?? 2,
    }))
    document.getElementById('stateLoading').style.display = 'none'
    document.getElementById('stateIdle').style.display    = 'block'
    updateSidebar(); renderDashboard(); renderBrawlers(); goTo('dashboard')
  } catch(err) {
    document.getElementById('stateLoading').style.display = 'none'
    document.getElementById('stateError').style.display   = 'block'
    document.getElementById('errorTitle').textContent = 'Error al cargar'
    document.getElementById('errorMsg').textContent   = err.message + ' ‚Äî Verifica que el backend est√° activo.'
  }
}

// ‚îÄ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateSidebar() {
  if (!playerData) return
  document.getElementById('sidebarPlayer').style.display = 'block'
  document.getElementById('spName').textContent     = playerData.name || '‚Äî'
  document.getElementById('spTag').textContent      = playerData.tag  || '‚Äî'
  document.getElementById('spTrophies').textContent = (playerData.trophies || 0).toLocaleString('es')
}

// ‚îÄ‚îÄ‚îÄ Cost helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function goldToMax(lvl) {
  let t = 0; for (let i = lvl; i < 11; i++) t += GOLD_PER_LEVEL[i]; return t
}
function ppToMax(lvl) {
  let t = 0; for (let i = lvl; i < 11; i++) t += PP_PER_LEVEL[i]; return t
}

// ‚îÄ‚îÄ‚îÄ Dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderDashboard() {
  if (!playerData || !allBrawlers.length) {
    document.getElementById('dashboardEmpty').style.display   = 'block'
    document.getElementById('dashboardContent').style.display = 'none'
    return
  }
  document.getElementById('dashboardEmpty').style.display   = 'none'
  document.getElementById('dashboardContent').style.display = 'block'
  document.getElementById('dashTitle').textContent    = `Hola, ${playerData.name}!`
  document.getElementById('dashSubtitle').textContent = `${playerData.tag} ¬∑ Nivel ${playerData.expLevel || 1}`
  document.getElementById('playerName').textContent       = playerData.name || '‚Äî'
  document.getElementById('playerTagDisplay').textContent = playerData.tag  || '‚Äî'
  document.getElementById('statPills').innerHTML = [
    { label:'üèÜ Trofeos', val:(playerData.trophies||0).toLocaleString('es'),        cls:'gold'  },
    { label:'üìà M√°x',     val:(playerData.highestTrophies||0).toLocaleString('es'), cls:''      },
    { label:'üèÖ Club',    val: playerData.club?.name || 'Sin club',                 cls:''      },
    { label:'üåç Exp',     val:`Nv. ${playerData.expLevel||1}`,                     cls:''      },
  ].map(p=>`<div class="pill">${p.label}: <span class="val ${p.cls}">${p.val}</span></div>`).join('')

  const total = window._totalInGame || 80
  const owned = allBrawlers.length
  const maxed = allBrawlers.filter(b=>(b.power||1)>=11).length
  const myG   = allBrawlers.reduce((s,b)=>s+(b.gadgets||[]).length,0)
  const totG  = allBrawlers.reduce((s,b)=>s+(b.totalGadgets??2),0)
  const mySP  = allBrawlers.reduce((s,b)=>s+(b.starPowers||[]).length,0)
  const totSP = allBrawlers.reduce((s,b)=>s+(b.totalSP??2),0)

  const cards = [
    { icon:'üéÆ', label:'Brawlers desbloqueados',   val:owned,  tot:total, color:'linear-gradient(90deg,var(--accent3),var(--purple))', vc:'var(--accent3)' },
    { icon:'‚≠ê', label:'Star Powers desbloqueados', val:mySP,   tot:totSP, color:'linear-gradient(90deg,var(--accent),var(--accent2))', vc:'var(--accent)'  },
    { icon:'‚öôÔ∏è', label:'Gadgets desbloqueados',     val:myG,    tot:totG,  color:'linear-gradient(90deg,var(--purple),#5533aa)',        vc:'var(--purple)'  },
    { icon:'üíé', label:'Brawlers a nivel 11',        val:maxed,  tot:owned, color:'linear-gradient(90deg,var(--green),#00aa66)',         vc:'var(--green)'   },
  ]
  document.getElementById('statsGrid').innerHTML = cards.map(c=>{
    const pct = c.tot > 0 ? Math.round((c.val/c.tot)*100) : 0
    return `<div class="stat-card">
      <div class="stat-card-accent" style="background:${c.color}"></div>
      <span class="stat-card-icon">${c.icon}</span>
      <div class="stat-card-label">${c.label}</div>
      <div class="stat-card-main">
        <span class="stat-card-value" style="color:${c.vc}">${c.val}</span>
        <span class="stat-card-total">/ ${c.tot}</span>
      </div>
      <div class="stat-progress-bg"><div class="stat-progress-fill" style="background:${c.color};width:${pct}%"></div></div>
      <div class="stat-progress-pct">${pct}% completado</div>
    </div>`
  }).join('')

  // Cost calculations
  let goldLvl=0, ppLvl=0
  for (const b of allBrawlers) { goldLvl += goldToMax(b.power||1); ppLvl += ppToMax(b.power||1) }
  const misG  = allBrawlers.reduce((s,b)=>s+Math.max(0,(b.totalGadgets??2)-(b.gadgets||[]).length),0)
  const misSP = allBrawlers.reduce((s,b)=>s+Math.max(0,(b.totalSP??2)-(b.starPowers||[]).length),0)
  const goldG = misG  * GADGET_COST
  const goldS = misSP * STARPOWER_COST
  const totGold = goldLvl + goldG + goldS
  const fmt = n => n.toLocaleString('es')

  document.getElementById('costGrid').innerHTML = `
    <div class="cost-card">
      <div class="cost-card-accent" style="background:linear-gradient(90deg,var(--accent),var(--accent2))"></div>
      <div class="cost-card-title">ü™ô Oro necesario</div>
      <div class="cost-card-subtitle">Para maxear niveles, gadgets y star powers</div>
      <div class="cost-row">
        <span class="cost-icon">‚¨ÜÔ∏è</span>
        <span class="cost-label">Subir todos al nivel 11</span>
        <span class="cost-value cost-gold">${fmt(goldLvl)}</span>
      </div>
      <div class="cost-row">
        <span class="cost-icon">‚öôÔ∏è</span>
        <span class="cost-label">Gadgets que faltan (√ó${misG})</span>
        <span class="cost-value ${goldG===0?'cost-zero':'cost-gold'}">${fmt(goldG)}</span>
      </div>
      <div class="cost-row">
        <span class="cost-icon">‚≠ê</span>
        <span class="cost-label">Star Powers que faltan (√ó${misSP})</span>
        <span class="cost-value ${goldS===0?'cost-zero':'cost-gold'}">${fmt(goldS)}</span>
      </div>
      <div class="cost-row" style="border-top:1px solid rgba(249,196,0,0.2);margin-top:4px;padding-top:12px">
        <span class="cost-icon">üí∞</span>
        <span class="cost-label"><strong>Total de oro</strong></span>
        <span class="cost-value cost-gold" style="font-size:1.55rem">${fmt(totGold)}</span>
      </div>
    </div>
    <div class="cost-card">
      <div class="cost-card-accent" style="background:linear-gradient(90deg,var(--purple),#5533aa)"></div>
      <div class="cost-card-title">‚ö° Puntos de Fuerza necesarios</div>
      <div class="cost-card-subtitle">Para subir todos tus brawlers al nivel 11</div>
      <div class="cost-row">
        <span class="cost-icon">üéÆ</span>
        <span class="cost-label">Brawlers sin maxear</span>
        <span class="cost-value cost-power">${owned - maxed}</span>
      </div>
      <div class="cost-row">
        <span class="cost-icon">‚úÖ</span>
        <span class="cost-label">Brawlers ya a nivel 11</span>
        <span class="cost-value cost-zero">${maxed}</span>
      </div>
      <div class="cost-row" style="border-top:1px solid rgba(155,93,229,0.25);margin-top:4px;padding-top:12px">
        <span class="cost-icon">‚ö°</span>
        <span class="cost-label"><strong>Total puntos de fuerza</strong></span>
        <span class="cost-value cost-power" style="font-size:1.55rem">${fmt(ppLvl)}</span>
      </div>
    </div>`
}

// ‚îÄ‚îÄ‚îÄ Brawlers page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setFilter(f, btn) {
  currentFilter = f
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'))
  btn.classList.add('active')
  renderBrawlers()
}

function renderBrawlers() {
  if (!allBrawlers.length) {
    document.getElementById('brawlersEmpty').style.display   = 'block'
    document.getElementById('brawlersContent').style.display = 'none'
    return
  }
  document.getElementById('brawlersEmpty').style.display   = 'none'
  document.getElementById('brawlersContent').style.display = 'block'
  const sort = document.getElementById('sortSelect').value
  let list = [...allBrawlers]
  if (currentFilter !== 'all') list = list.filter(b=>b.rarity===currentFilter)
  list.sort((a,b)=>{
    if (sort==='trophies') return (b.trophies||0)-(a.trophies||0)
    if (sort==='level')    return (b.power||0)-(a.power||0)
    if (sort==='name')     return a.name.localeCompare(b.name)
    return 0
  })
  const maxT = Math.max(...list.map(b=>b.trophies||0),1)
  document.getElementById('brawlerCount').innerHTML =
    `Mostrando <span>${list.length}</span> de <span>${allBrawlers.length}</span> brawlers`
  document.getElementById('brawlersGrid').innerHTML = list.map((b,i)=>buildCard(b,i,maxT)).join('')
}

function buildCard(b, idx, maxT) {
  const rc  = (b.rarity && b.rarity !== 'Unknown' ? b.rarity : 'default').replace(/\s+/g,'-')
  const portraitUrl = getPortrait(b.name)
  const pct = Math.min(100,((b.trophies||0)/maxT)*100).toFixed(1)
  const lvl = b.power||1
  const d   = Math.min(idx*30,600)
  const g   = (b.gadgets||[]).map(x=>uRow('‚öôÔ∏è',x.name,'gadget')).join('')
  const sp  = (b.starPowers||[]).map(x=>uRow('‚≠ê',x.name,'star')).join('')
  const gr  = (b.gears||[]).map(x=>uRow('üî©',x.name,'gear')).join('')
  const all = g+sp+gr
  return `<div class="brawler-card" style="animation-delay:${d}ms">
    <div class="card-header">
      <div class="rarity-strip rarity-${rc}"></div>
      <div class="brawler-icon icon-bg-${rc}">
        ${portraitUrl
          ? `<img src="${portraitUrl}" alt="${b.name}" loading="lazy" onerror="this.parentElement.innerHTML='‚≠ê'">`
          : `<span>‚≠ê</span>`}
      </div>
      <div><div class="brawler-name">${b.name}</div><div class="brawler-role">${b.rarity||'Unknown'}</div></div>
      <div class="level-badge"><div class="lvl-num lvl-${lvl}">${lvl}</div><div class="lvl-label">Power</div></div>
    </div>
    <div class="card-body">
      <div class="trophy-row">
        <span>üèÜ</span>
        <div class="trophy-bar-bg"><div class="trophy-bar-fill" style="width:${pct}%"></div></div>
        <span class="trophy-val">${(b.trophies||0).toLocaleString('es')}</span>
      </div>
      <div class="upgrades-section">
        <div class="upg-title">Gadgets ¬∑ Star Powers ¬∑ Gears</div>
        ${all?`<div class="upg-list">${all}</div>`:'<p class="no-upgrades">Sin gadgets ni star powers</p>'}
      </div>
    </div>
  </div>`
}

function uRow(icon, name, type) {
  const labels = {gadget:'Gadget',star:'Star Power',gear:'Gear'}
  return `<div class="upg-item"><span class="upg-icon">${icon}</span><span class="upg-name">${name}</span><span class="upg-type type-${type}">${labels[type]}</span></div>`
}

document.addEventListener('keydown', e => { if (e.key==='Enter') fetchPlayer() })
</script>
</body>
</html>
